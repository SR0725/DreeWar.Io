const express=require("express"),app=express(),server=require("http").Server(app),io=require("socket.io")(server);var gameUpdateFunction,occupyTime=0,eoccupyTime=0,foccupyTime={1:0,2:0,3:0,4:0,5:0,6:0,7:0,8:0},spawnTowerList={0:{x:129,y:1036,team:1},1:{x:129,y:636,team:1},2:{x:4019,y:1036,team:2},3:{x:4019,y:636,team:2}},bluescore=0,redscore=0,gamestat=1,onlineCount=0,blueTeamCount=0,redTeamCount=0,playerlist={},kdalist={},oplist={},skillObject={},effectlist={},buildinglist={},skillindex=0,effectindex=0,buildingindex=0,gametick=0,gamestarting=!1,beegen_count={1:0,2:0},bp1getTick=0,bp2getTick=0,flowergen_count={1:0,2:0},mp1getTick=0,mp2getTick=0,password="dreamcity",gameStartingJoin=!1,friendlyFire=!1,mpBasicRegVal=5,bpBasicRegVal=15,bpBasicRegMul=.8,mpBasicRegMul=.8,winscore=300;function colliderBoxCircle(e,t,i,a,m,o,s){return Math.pow(e+.5*i-m,2)+Math.pow(t+30+.5*a-o,2)<=Math.pow(s+32,2)}function dataDeal_Player(){for(let[e,t]of Object.entries(playerlist))t.damage=20,t.speed=6,1==t.team?(mp1getTick>1e4*Math.pow(.9,flowergen_count[1])&&t.mp<10&&(t.mp+=1),bp1getTick>3e4*Math.pow(.9,beegen_count[1])&&t.bp<3&&(t.bp+=1)):(mp2getTick>1e4*Math.pow(.9,flowergen_count[2])&&t.mp<10&&(t.mp+=1),bp2getTick>3e4*Math.pow(.9,beegen_count[2])&&t.bp<3&&(t.bp+=1))}function mp_bp_Get(){if(mp1getTick>1e3*mpBasicRegVal*Math.pow(mpBasicRegMul,flowergen_count[1])){mp1getTick=0;for(let[e,t]of Object.entries(playerlist))1==t.team&&t.mp<10&&(t.mp+=1)}if(mp2getTick>1e3*mpBasicRegVal*Math.pow(mpBasicRegMul,flowergen_count[2])){mp2getTick=0;for(let[e,t]of Object.entries(playerlist))2==t.team&&t.mp<10&&(t.mp+=1)}if(bp1getTick>1e3*bpBasicRegVal*Math.pow(bpBasicRegMul,beegen_count[1])){bp1getTick=0;for(let[e,t]of Object.entries(playerlist))1==t.team&&t.bp<3&&(t.bp+=1)}if(bp2getTick>1e3*bpBasicRegVal*Math.pow(bpBasicRegMul,beegen_count[2])){bp2getTick=0;for(let[e,t]of Object.entries(playerlist))2==t.team&&t.bp<3&&(t.bp+=1)}mp1getTick+=20,bp1getTick+=20,mp2getTick+=20,bp2getTick+=20}function deathDeal(e,t,i){var a="n";for(let[e,i]of Object.entries(playerlist))if(i.id==t){a=e;break}if("n"!=a)switch(kdalist[a].kill+=1,i){case 0:io.to("GameRoom").emit("msg",{message:playerlist[e].name+"被"+playerlist[a].name+"的火焰貫穿了!",name:"世界之聲"});break;case 1:io.to("GameRoom").emit("msg",{message:playerlist[e].name+"被"+playerlist[a].name+"招喚的地縫夾殺了!",name:"世界之聲"});break;case 2:io.to("GameRoom").emit("msg",{message:playerlist[e].name+"被"+playerlist[a].name+"重創致死了!",name:"世界之聲"})}else io.to("GameRoom").emit("msg",{message:playerlist[e].name+"在火焰升天!",name:"世界之聲"});kdalist[e].death+=1,io.to(e).emit("die"),playerlist[e].health=100,io.to("GameRoom").emit("kdaDataGet",kdalist)}function dataDeal_Skill(){for(let[e,t]of Object.entries(skillObject))if(t.time<t.maintime){switch(t.x+=t.motion_x,t.y+=t.motion_y,t.skill){case 0:for(let[i,a]of Object.entries(playerlist))if(0==friendlyFire){if(a.team!=t.team&&colliderBoxCircle(a.x,a.y,64,128,t.x,t.y,30)){a.health-=t.damage,io.to("GameRoom").emit("particleDataGet",{particle:1,time:1,maintime:300,x:t.x,y:t.y}),io.to(i).emit("hurt"),a.health<=0&&deathDeal(i,t.id,0),delete skillObject[e];break}}else if(a.id!=t.id&&colliderBoxCircle(a.x,a.y,64,128,t.x,t.y,30)){a.health-=t.damage,io.to("GameRoom").emit("particleDataGet",{particle:1,time:1,maintime:300,x:t.x,y:t.y}),io.to(i).emit("hurt"),a.health<=0&&deathDeal(i,t.id,0),delete skillObject[e];break}for(let[i,a]of Object.entries(buildinglist))if((2==a.type||5==a.type||(1==a.type||3==a.type||4==a.type)&&a.team!=t.team)&&Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)<4096){a.health-=t.damage,io.to("GameRoom").emit("particleDataGet",{particle:1,time:1,maintime:300,x:t.x,y:t.y}),io.to("GameRoom").emit("buildDataUpdata",a,i),delete skillObject[e];break}break;case 2:if(1==t.race){gametick%5==1&&io.to("GameRoom").emit("particleDataGet",{particle:3,time:1,maintime:500,x:t.x,y:t.y});for(let[i,a]of Object.entries(playerlist))if(0==friendlyFire){if(a.team!=t.team&&colliderBoxCircle(a.x,a.y,64,128,t.x,t.y,50)){a.health-=t.damage,io.to("GameRoom").emit("particleDataGet",{particle:1,time:1,maintime:300,x:t.x,y:t.y}),io.to(i).emit("hurt"),effectlist[effectindex]={id:t.id,name:t.name,team:t.team,x:t.x+30,y:t.y+70,effected:a.id,distance:100,type:2,level:0,time:0,maintime:1500},effectindex+=1,a.health<=0&&deathDeal(i,t.id,1),delete skillObject[e];break}}else if(a.id!=t.id&&colliderBoxCircle(a.x,a.y,64,128,t.x,t.y,50)){a.health-=t.damage,io.to("GameRoom").emit("particleDataGet",{particle:1,time:1,maintime:300,x:t.x,y:t.y}),io.to(i).emit("hurt"),effectlist[effectindex]={id:t.id,name:t.name,team:t.team,x:t.x+30,y:t.y+70,effected:a.id,distance:100,type:2,level:0,time:0,maintime:1500},effectindex+=1,a.health<=0&&deathDeal(i,t.id,1),delete skillObject[e];break}for(let[i,a]of Object.entries(buildinglist))if((2==a.type||5==a.type||(1==a.type||3==a.type||4==a.type)&&a.team!=t.team)&&Math.pow(a.x-t.x,2)+Math.pow(a.y-t.y,2)<4096){a.health-=6*t.damage,io.to("GameRoom").emit("particleDataGet",{particle:1,time:1,maintime:300,x:t.x,y:t.y}),io.to("GameRoom").emit("buildDataUpdata",a,i),delete skillObject[e];break}}}t.time+=20}else delete skillObject[e]}function dataDeal_Effect(){for(let[e,t]of Object.entries(effectlist))if(t.time<t.maintime){for(let[e,i]of Object.entries(playerlist))if((i.team==t.effected||i.id==t.effected)&&colliderBoxCircle(i.x,i.y,64,128,t.x,t.y,t.distance))switch(t.type){case 1:playerlist[e].damage*=t.level,0==t.time&&io.to(e).emit("effectDataGet",{effect:1,time:0,maintime:t.maintime});break;case 2:playerlist[e].speed*=t.level,0==t.time&&io.to(e).emit("effectDataGet",{effect:2,time:0,maintime:t.maintime});break;case 3:i.health-=t.level,io.to(e).emit("hurt"),i.health<=0&&deathDeal(e,t.id,2)}t.time+=20}else delete effectlist[e]}function dataDeal_Building(){for(let[e,t]of Object.entries(buildinglist))if(t.health>1)switch(t.type){case 3:for(let[e,i]of Object.entries(playerlist))i.team!=t.team&&gametick%150==1&&colliderBoxCircle(i.x,i.y,64,128,t.x,t.y,800)&&shoot(t.x,t.y,i.x,i.y,t.team,10);break;case 5:for(let[e,i]of Object.entries(playerlist))gametick%100==1&&colliderBoxCircle(i.x,i.y,64,128,t.x,t.y,400)&&(i.health+=1)}else 1==t.type?beegen_count[t.team]-=1:3==t.type&&(flowergen_count[t.team]-=1),io.to("GameRoom").emit("buildDataDel",e),delete buildinglist[e]}function gameSystem(){for(let[e,t]of Object.entries(playerlist))t.x<2291&&t.x>1874&&t.y<955&&t.y>563?1==t.team?occupyTime-=1:occupyTime+=1:t.x<1750&&t.x>1450&&t.y<400&&t.y>281?1==t.team?foccupyTime[1]-=1:foccupyTime[1]+=1:t.x<1750&&t.x>1450&&t.y<1260&&t.y>1100?1==t.team?foccupyTime[2]-=1:foccupyTime[2]+=1:t.x<2842&&t.x>2500&&t.y<400&&t.y>281?1==t.team?foccupyTime[3]-=1:foccupyTime[3]+=1:t.x<2842&&t.x>2500&&t.y<1260&&t.y>1100&&(1==t.team?foccupyTime[4]-=1:foccupyTime[4]+=1);occupyTime<-5&&(occupyTime=-5),occupyTime>5&&(occupyTime=5);for(var e=1;e<=4;e++)foccupyTime[e]>3&&(foccupyTime[e]=3),foccupyTime[e]<-3&&(foccupyTime[e]=-3);if(-5==occupyTime&&(bluescore+=1),5==occupyTime&&(redscore+=1),bluescore>=winscore){for(let[e,t]of Object.entries(playerlist))1==t.team?io.to(e).emit("winGame"):io.to(e).emit("loseGame");gamestat=3,setTimeout(function(){gameRestart()},15e3)}else if(redscore>=winscore){for(let[e,t]of Object.entries(playerlist))2==t.team?io.to(e).emit("winGame"):io.to(e).emit("loseGame");gamestat=3,setTimeout(function(){gameRestart()},15e3)}for(e=1;e<=4;e++){var t,i;switch(e){case 1:t=1614,i=361;break;case 2:t=1614,i=1212;break;case 3:t=2692,i=361;break;case 4:t=2692,i=1212}3==foccupyTime[e]&&foccupyTime[e+4]!=foccupyTime[e]?io.to("GameRoom").emit("particleDataGet",{particle:5,time:1,maintime:1e3,x:t,y:i}):-3==foccupyTime[e]&&foccupyTime[e+4]!=foccupyTime[e]&&io.to("GameRoom").emit("particleDataGet",{particle:4,time:1,maintime:1e3,x:t,y:i}),foccupyTime[e+4]=foccupyTime[e]}if(5==occupyTime&&occupyTime!=eoccupyTime?io.to("GameRoom").emit("particleDataGet",{particle:5,time:1,maintime:1e3,x:2130,y:696}):-5==occupyTime&&occupyTime!=eoccupyTime&&io.to("GameRoom").emit("particleDataGet",{particle:4,time:1,maintime:1e3,x:2130,y:696}),eoccupyTime=occupyTime,-5==occupyTime){for(e=1;e<=4;e++)if(3==foccupyTime[e])switch(e){case 1:for(var a=0;a<2;a++)shoot(1614,361,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),2,5);break;case 2:for(a=0;a<2;a++)shoot(1614,1212,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),2,5);break;case 3:for(a=0;a<2;a++)shoot(2692,361,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),2,5);break;case 4:for(a=0;a<2;a++)shoot(2692,1212,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),2,5)}}else if(5==occupyTime)for(e=1;e<=4;e++)if(-3==foccupyTime[e])switch(e){case 1:for(a=0;a<2;a++)shoot(1614,361,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),1,5);break;case 2:for(a=0;a<2;a++)shoot(1614,1212,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),1,5);break;case 3:for(a=0;a<2;a++)shoot(2692,361,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),1,5);break;case 4:for(a=0;a<2;a++)shoot(2692,1212,2130+400*(Math.random()-.5),796+400*(Math.random()-.5),1,5)}for(let[e,t]of Object.entries(spawnTowerList))for(let[e,i]of Object.entries(playerlist))i.team!=t.team&&colliderBoxCircle(i.x,i.y,64,128,t.x,t.y,700)&&shoot(t.x,t.y,i.x,i.y,t.team,80);io.to("GameRoom").emit("gameDataGet",{bluescore:bluescore,redscore:redscore,occupyTime:occupyTime,foccupyTime:foccupyTime})}function gameUpdate(){dataDeal_Player(),mp_bp_Get(),dataDeal_Skill(),dataDeal_Effect(),dataDeal_Building(),gametick%50==1&&3!=gamestat&&gameSystem(),gametick+=1,skillObject.tick=gametick,playerlist.tick=gametick,io.to("GameRoom").emit("skillDataGet",skillObject),io.to("GameRoom").emit("playerDataUpdata",playerlist)}function commandTest(e,t){let i=e.message.substr(1,e.length).split(" ");switch(e.message.substr(0,1)){case"/":try{switch(i[0]){case"start":1==oplist[t]?1==gamestat&&gameStart():io.to(t).emit("msg",{message:"你的權限無法使用該指令!",name:"世界之聲"});break;case"gamerule":if(1==oplist[t])switch(i[1]){case"gameStartingJoin":"true"==i[2]?(gameStartingJoin=!0,io.emit("msg",{message:"世界規則已經修改,玩家能在遊戲開始後進入",name:"世界之聲"})):"true"==i[2]?(gameStartingJoin=!1,io.emit("msg",{message:"世界規則已經修改,玩家不能在遊戲開始後進入",name:"世界之聲"})):gameStartingJoin?io.emit("msg",{message:"世界規則目前設定,玩家能在遊戲開始後進入",name:"世界之聲"}):io.emit("msg",{message:"世界規則目前設定,玩家不能在遊戲開始後進入",name:"世界之聲"});break;case"friendlyFire":"true"==i[2]?(friendlyFire=!0,io.emit("msg",{message:"世界規則已經修改,同隊傷害已開啟",name:"世界之聲"})):"true"==i[2]?(friendlyFire=!1,io.emit("msg",{message:"世界規則已經修改,同隊傷害已關閉",name:"世界之聲"})):friendlyFire?io.emit("msg",{message:"世界規則目前設定,同隊傷害已開啟",name:"世界之聲"}):io.emit("msg",{message:"世界規則目前設定,同隊傷害已關閉",name:"世界之聲"});break;default:io.to(t).emit("msg",{message:"遊戲規則更改失敗，請檢察語法",name:"世界之聲"})}else io.to(t).emit("msg",{message:"你的權限無法使用該指令!",name:"世界之聲"});break;case"login":i[1]==password?(oplist[t]=!0,io.to(t).emit("msg",{message:"你已成功獲得管理員權限!",name:"世界之聲"})):io.to(t).emit("msg",{message:"密碼錯誤!!",name:"世界之聲"});break;case"data":if(1==oplist[t])if("get"==i[1])if("@a"==i[2])if(3==i.length)io.to(t).emit("msg",{message:JSON.stringify(playerlist),name:"世界之聲"});else for(let[e,t]of Object.entries(playerlist))io.to(e).emit("msg",{message:"id:"+e+":"+JSON.stringify(t[i[3]]),name:"世界之聲"});else io.to(t).emit("msg",{message:"id:"+t+":"+JSON.stringify(playerlist[i[2]][i[3]]),name:"世界之聲"});else if("set"==i[1]){if(3==i.length)io.to(t).emit("msg",{message:"更替數值路徑未輸入",name:"世界之聲"});else if(4==i.length)io.to(t).emit("msg",{message:"數值未輸入",name:"世界之聲"});else if("@a"==i[2]){for(let[e,t]of Object.entries(playerlist))t[i[3]]=i[4];io.to(t).emit("msg",{message:"已完成所由玩家的數值更替",name:"世界之聲"})}else playerlist[i[2]][i[3]]=i[4],io.to(t).emit("msg",{message:"已完成單個玩家的數值更替",name:"世界之聲"});io.to("GameRoom").emit("playerDataUpdata",playerlist)}else io.to(t).emit("msg",{message:"指令輸入不完全!",name:"世界之聲"});else io.to(t).emit("msg",{message:"你的權限無法使用該指令!",name:"世界之聲"});break;case"gameval":if(1==oplist[t])if("get"==i[1])switch(i[2]){case"mpBasicRegVal":io.to(t).emit("msg",{message:"mp獲得時間基礎值為"+mpBasicRegVal,name:"世界之聲"});break;case"bpBasicRegVal":io.to(t).emit("msg",{message:"bp獲得時間基礎值為"+bpBasicRegVal,name:"世界之聲"});break;case"mpBasicRegMul":io.to(t).emit("msg",{message:"bp獲得時間基礎值為"+mpBasicRegMul,name:"世界之聲"});break;case"bpBasicRegMul":io.to(t).emit("msg",{message:"bp獲得時間基礎值為"+bpBasicRegMul,name:"世界之聲"});break;case"winScore":io.to(t).emit("msg",{message:"勝利分數為"+winscore,name:"世界之聲"});break;default:io.to(t).emit("msg",{message:"查無此世界參數",name:"世界之聲"})}else if("set"==i[1])switch(i[2]){case"mpBasicRegVal":mpBasicRegVal=i[3],io.to(t).emit("msg",{message:"mp獲得時間基礎值更改為"+mpBasicRegVal,name:"世界之聲"});break;case"bpBasicRegVal":bpBasicRegVal=i[3],io.to(t).emit("msg",{message:"bp獲得時間基礎值更改為"+bpBasicRegVal,name:"世界之聲"});break;case"mpBasicRegMul":mpBasicRegMul=i[3],io.to(t).emit("msg",{message:"花園生產倍率基數更改為"+mpBasicRegMul,name:"世界之聲"});break;case"bpBasicRegMul":bpBasicRegMul=i[3],io.to(t).emit("msg",{message:"蜂之園生產倍率基數更改為"+bpBasicRegMul,name:"世界之聲"});break;case"winScore":winscore=i[3],io.to(t).emit("msg",{message:"勝利分數為"+winscore,name:"世界之聲"});break;default:io.to(t).emit("msg",{message:"查無此世界參數",name:"世界之聲"})}else io.to(t).emit("msg",{message:"指令輸入不完全!",name:"世界之聲"});else io.to(t).emit("msg",{message:"你的權限無法使用該指令!",name:"世界之聲"});break;case"passwordchange":1==oplist[t]?(password=i[1],io.to(t).emit("msg",{message:"密碼已更正成:"+i[1],name:"世界之聲"})):io.to(t).emit("msg",{message:"你的權限無法使用該指令!",name:"世界之聲"});break;case"restart":1==oplist[t]?gameRestart():io.to(t).emit("msg",{message:"你的權限無法使用該指令!",name:"世界之聲"});break;case"oplist":io.to(t).emit("msg",{message:JSON.stringify(oplist),name:"世界之聲"});default:io.to(t).emit("msg",{message:"無此指令!",name:"世界之聲"})}}catch(e){io.to(t).emit("msg",{message:"發生錯誤:"+e,name:"世界之聲"})}break;default:e.message=e.message.replace(/</g,"&lt;"),e.message=e.message.replace(/>/g,"&gt;"),e.message=e.message.replace(/"/g,"&quot;"),e.message=e.message.replace(/'/g,"&#x27;"),io.emit("msg",e)}}function shoot(e,t,i,a,m,o){var s=i-e,l=a-t+64,c=Math.sqrt(Math.pow(s,2)+Math.pow(l,2)),n={id:"bigAnt",name:"砲塔",x:e,y:t,motion_x:s*=32/c,motion_y:l*=32/c,team:m,skill:0,race:0,damage:o,time:0,maintime:1e3};skillObject[skillindex]=n,skillindex+=1}function gameStart(){gamestarting=!0,io.to("GameRoom").emit("playerCount",onlineCount),io.to("GameRoom").emit("gameStart"),io.to("GameRoom").emit("kdaDataGet",kdalist),gamestat=2,gameUpdateFunction=setInterval(gameUpdate,20),console.log("遊戲開始")}function gameRestart(){io.to("GameRoom").emit("msg",{message:"世界將在1秒後重置!",name:"世界之聲"}),clearInterval(gameUpdateFunction),gamestarting=!1,occupyTime=0,eoccupyTime=0,(foccupyTime={})[1]=0,foccupyTime[2]=0,foccupyTime[3]=0,foccupyTime[4]=0,foccupyTime[5]=0,foccupyTime[6]=0,foccupyTime[7]=0,foccupyTime[8]=0,spawnTowerList={},bluescore=0,redscore=0,gamestat=1,onlineCount=0,blueTeamCount=0,redTeamCount=0,playerlist={},kdalist={},oplist={},skillObject={},effectlist={},buildinglist={},skillindex=0,effectindex=0,buildingindex=0,gametick=0,(beegen_count={})[1]=0,beegen_count[2]=0,bp1getTick=0,bp2getTick=0,(flowergen_count={})[1]=0,flowergen_count[2]=0,mp1getTick=0,mp2getTick=0,setTimeout(function(){io.emit("restartGame")},1e3)}io.on("connection",e=>{console.log("有人連線了!SocketId:"+e.id),e.on("login",t=>{try{oplist[e.id]=!1,++onlineCount>=4&&0==gamestarting&&(gamestarting=!0,io.emit("msg",{message:"遊戲將在10秒後開始!",name:"世界之聲"}),setTimeout(function(){gameStart()},1e4)),t.name=t.name.replace(/</g,"&lt;"),t.name=t.name.replace(/>/g,"&gt;"),t.name=t.name.replace(/"/g,"&quot;"),t.name=t.name.replace(/'/g,"&#x27;"),playerlist[e.id]={id:t.id,name:t.name,health:100,team:1,mp:10,bp:3,x:0,y:0,motion_x:0,motion_y:0,flip:!1,speed:6,damage:20,animation:0},kdalist[e.id]={kill:0,death:0,support:0},blueTeamCount>redTeamCount?(playerlist[e.id].team=2,redTeamCount+=1):(playerlist[e.id].team=1,blueTeamCount+=1),console.log(playerlist[e.id].name+"進入伺服器-SocketID:"+playerlist[e.id].id),gamestat<=1?(io.to(e.id).emit("logToWaitingRoom"),e.join("GameRoom"),io.to("GameRoom").emit("playerDataUpdata",playerlist)):gameStartingJoin?(io.to(e.id).emit("buildDataInt",buildinglist),io.to(e.id).emit("playerDataUpdata",playerlist),setTimeout(function(){io.to(e.id).emit("gameStart"),io.to(e.id).emit("kdaDataGet",kdalist)},500),e.join("GameRoom"),io.to("GameRoom").emit("playerDataUpdata",playerlist)):io.to(e.id).emit("canNotLog")}catch(e){console.log("有些錯誤在login階段發生了!詳細訊息:"+e)}}),e.on("blueTeamJoin",()=>{2==playerlist[e.id].team&&(playerlist[e.id].team=1,io.to("GameRoom").emit("playerDataUpdata",playerlist),console.log(playerlist[e.id].name+"換隊伍成為了藍隊-SocketID:"+playerlist[e.id].id),blueTeamCount+=1,redTeamCount-=1)}),e.on("redTeamJoin",()=>{1==playerlist[e.id].team&&(playerlist[e.id].team=2,io.to("GameRoom").emit("playerDataUpdata",playerlist),console.log(playerlist[e.id].name+"換隊伍成為了紅色隊-SocketID:"+playerlist[e.id].id),blueTeamCount-=1,redTeamCount+=1)}),e.on("playerDataGet",t=>{try{2==gamestat&&(playerlist[e.id].x=t.x,playerlist[e.id].y=t.y,playerlist[e.id].motion_x=t.motion_x,playerlist[e.id].motion_y=t.motion_y,playerlist[e.id].animation=t.animation,playerlist[e.id].flip=t.flip)}catch(e){}}),e.on("mpUse",t=>{try{playerlist[e.id].mp-=t.mpuse}catch(e){}}),e.on("bpUse",t=>{try{playerlist[e.id].bp-=t.bpuse}catch(e){}}),e.on("skillDataGet",e=>{try{skillObject[skillindex]=e,skillindex+=1}catch(e){}}),e.on("particleDataGet",e=>{try{io.to("GameRoom").emit("particleDataGet",e)}catch(e){}}),e.on("effectDataGet",e=>{try{effectlist[effectindex]=e,effectindex+=1}catch(e){}}),e.on("emotionDataGet",t=>{try{io.to("GameRoom").emit("emotionDataGet",t,e.id)}catch(e){}}),e.on("buildingDataGet",e=>{try{buildinglist[buildingindex]=e,io.to("GameRoom").emit("buildDataGet",e,buildingindex),1==e.type&&(beegen_count[e.team]+=1),4==e.type&&(flowergen_count[e.team]+=1),buildingindex+=1}catch(e){}}),e.on("send",t=>{Object.keys(t).length<2||commandTest(t,e.id)}),e.on("disconnect",()=>{try{1==playerlist[e.id].online&&(onlineCount=onlineCount<0?0:onlineCount-=1),io.to("GameRoom").emit("playerCount",onlineCount),2==playerlist[e.id].team&&(redTeamCount-=1),1==playerlist[e.id].team&&(blueTeamCount-=1),delete playerlist[e.id],delete kdalist[e.id],io.emit("playerDataUpdata",playerlist)}catch(e){}})}),app.get("/",(e,t)=>{t.sendFile(__dirname+"/views/index.html")}),app.get("/index.css",(e,t)=>{t.sendFile(__dirname+"/views/index.css")}),app.get("/scripts/:id",(e,t)=>{t.sendFile(__dirname+"/views/scripts/"+e.params.id)}),app.get("/scripts/jquery-ui/:id",(e,t)=>{t.sendFile(__dirname+"/views/scripts/jquery-ui/"+e.params.id)}),app.get("/views/img/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/"+e.params.id)}),app.get("/views/img/Blue/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/Blue/"+e.params.id)}),app.get("/views/img/Pink/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/Pink/"+e.params.id)}),app.get("/views/img/skill/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/skill/"+e.params.id)}),app.get("/views/img/effect/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/effect/"+e.params.id)}),app.get("/views/img/particle/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/particle/"+e.params.id)}),app.get("/views/img/build/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/build/"+e.params.id)}),app.get("/views/img/UI/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/UI/"+e.params.id)}),app.get("/views/img/emotion/:id",(e,t)=>{t.sendFile(__dirname+"/views/img/emotion/"+e.params.id)}),app.get("/views/audio/button/:id",(e,t)=>{t.sendFile(__dirname+"/views/audio/button/"+e.params.id)}),app.get("/views/audio/game/:id",(e,t)=>{t.sendFile(__dirname+"/views/audio/game/"+e.params.id)}),server.listen(3e3,()=>{console.log("Server Started. http://localhost:3000")});
