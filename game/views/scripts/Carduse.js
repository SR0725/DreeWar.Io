function skillCardRand(){if(0==cardchoose)return 0;for(var e=0;e<4&&!(card[e]>1e3&&e!=cardchoose);e++)if(3==e)return l();var a=0;for(e=0;e<4;e++)if(card[e]>1e3&&e!=cardchoose&&(a+=1),a>2)return i();return 100*Math.random()<50?i():l();function i(){var e=100*Math.random();return e<50?10*race+1:e<80?10*race+2:10*race+3}function l(){var e=100*Math.random();return e<20?1001:e<40?1002:e<60?1003:e<80?1004:1005}}function cardDisplay(e){switch(e){case 0:return'<img src="views/img/skill/normal_attack.png" class="card-img-top" align="middle">';case 11:return'<img src="views/img/skill/'+race+'_skill1.png" class="card-img-top" align="middle">';case 12:return'<img src="views/img/skill/'+race+'_skill2.png" class="card-img-top" align="middle">';case 13:return'<img src="views/img/skill/'+race+'_skill3.png" class="card-img-top" align="middle">';case 1001:return'<img src="views/img/skill/b_beegen.png" class="card-img-top" align="middle">';case 1002:return'<img src="views/img/skill/b_wall.png" class="card-img-top" align="middle">';case 1003:return'<img src="views/img/skill/b_fort.png" class="card-img-top" align="middle">';case 1004:return'<img src="views/img/skill/b_flowergen.png" class="card-img-top" align="middle">';case 1005:return'<img src="views/img/skill/b_hptower.png" class="card-img-top" align="middle">'}}function skillCardInit(){card[0]=0,card[1]=1001,card[2]=10*race+1,card[3]=10*race+2,document.getElementById("card").innerHTML='<div class="col-1"><div class="card bg-transparent magiccard border-0 card0" id="card0">'+cardDisplay(card[0])+'</div></div><div class="col-1"><div class="card bg-transparent magiccard border-0 card1" id="card1">'+cardDisplay(card[1])+'</div></div><div class="col-1"><div class="card bg-transparent magiccard border-0 card2" id="card2">'+cardDisplay(card[2])+'</div></div><div class="col-1"><div class="card bg-transparent magiccard border-0 card3" id="card3">'+cardDisplay(card[3])+"</div></div>",$("#card"+cardchoose).rotate({animateTo:15,duration:200})}function skillCardUse(){if(!(respawnTime>0))if(card[cardchoose]>1e3&&buildingTest())ActionBarShow("距離其他建築過近,無法建築!");else switch(card[cardchoose]){case 0:if(selfPlayer.mp>=1){mpUse(1),skill0Down();card[cardchoose];cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)}else ActionBarShow("花粉魔力不足!");break;case 11:1==race&&(selfPlayer.mp>=2?(mpUse(2),skill1_1Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("花粉魔力不足!"));break;case 12:selfPlayer.mp>=3?(mpUse(3),skill1_2Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("花粉魔力不足!");break;case 13:selfPlayer.mp>=4?(mpUse(4),skill1_3Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("花粉魔力不足!");break;case 1001:selfPlayer.bp>=3?(bpUse(3),building1Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("蜂蜜不足!");break;case 1002:selfPlayer.bp>=1?(bpUse(1),building2Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("蜂蜜不足!");break;case 1003:selfPlayer.bp>=2?(bpUse(2),building3Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("蜂蜜不足!");break;case 1004:selfPlayer.bp>=3?(bpUse(3),building4Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("蜂蜜不足!");break;case 1005:selfPlayer.bp>=3?(bpUse(3),building5Down(),cardDisplayChange(),$("#cardUseAnimation").append('<img src="views/img/skill/normal_attack.png" class="card-img-top cardUse" align="middle" style="width: 8rem;">'),setTimeout(function(){document.getElementById("cardUseAnimation").innerHTML=""},1e3)):ActionBarShow("蜂蜜不足!")}}function cardDisplayChange(){card[cardchoose]=skillCardRand(),document.getElementById("card"+cardchoose.toString()).innerHTML=cardDisplay(card[cardchoose])}function skill0Down(){musicPlay("fireball_shoot",ShootVolume);var e=mouse_x-Window_width/2,a=mouse_y-Window_height/2,i=Math.sqrt(Math.pow(e,2)+Math.pow(a,2));e*=32/i,a*=32/i,selfPlayer.animation=2,selfPlayer.motion_x=0,selfPlayer.motion_y=0,animationMainTime=0;var l={id:id,name:selfPlayer.name,x:selfPlayer.x+30,y:selfPlayer.y+70,motion_x:e,motion_y:a,team:selfPlayer.team,skill:0,race:race,damage:selfPlayer.damage,time:0,maintime:1e3};skillDataSend(l)}function skill1_1Down(){musicPlay("tie_breaker",ShootVolume),selfPlayer.animation=2,selfPlayer.motion_x=0,selfPlayer.motion_y=0,animationMainTime=0;var e={id:id,name:selfPlayer.name,team:selfPlayer.team,x:selfPlayer.x+30,y:selfPlayer.y+70,effected:selfPlayer.team,distance:480,type:1,level:1.2,time:0,maintime:5e3};if(effectDataSend(e),1==selfPlayer.team)var a=2;else a=1;e={id:id,name:selfPlayer.name,team:selfPlayer.team,x:selfPlayer.x+30,y:selfPlayer.y+70,effected:a,distance:480,type:2,level:.8,time:0,maintime:5e3};effectDataSend(e)}function skill1_2Down(){musicPlay("time",ShootVolume);var e=mouse_x-Window_width/2,a=mouse_y-Window_height/2,i=Math.sqrt(Math.pow(e,2)+Math.pow(a,2));e*=12/i,a*=12/i,selfPlayer.animation=2,selfPlayer.motion_x=0,selfPlayer.motion_y=0,animationMainTime=0;var l={id:id,name:selfPlayer.name,x:selfPlayer.x+30,y:selfPlayer.y+70,motion_x:e,motion_y:a,team:selfPlayer.team,skill:2,race:race,damage:10,time:0,maintime:1e3};skillDataSend(l)}function skill1_3Down(){musicPlay("prepare_yourself",ShootVolume),selfPlayer.animation=2;var e=!1,a=99999999,i=0,l=id;for(let[n,r]of Object.entries(playerlist_Now))r.id!=id&&Math.pow(r.x-selfPlayer.x,2)+Math.pow(r.y-selfPlayer.y,2)<a&&r.x>-100&&(i=n,l=r.id,a=Math.pow(r.x-selfPlayer.x,2)+Math.pow(r.y-selfPlayer.y,2),e=!0);if(0!=e){Tracing=!0,TracingObmx=.025*(playerlist_Now[i].x-selfPlayer.x),TracingObmy=.025*(playerlist_Now[i].y-selfPlayer.y),TracingOs=0,selfPlayer.motion_x=0,selfPlayer.motion_y=0,animationMainTime=0;var n={id:id,name:selfPlayer.name,team:selfPlayer.team,x:playerlist[i].x,y:playerlist[i].y,effected:l,distance:100,type:3,level:30,time:1,maintime:2};effectDataSend(n);n={id:id,name:selfPlayer.name,team:selfPlayer.team,x:selfPlayer.x+30,y:selfPlayer.y+70,effected:id,distance:100,type:1,level:1.5,time:0,maintime:2e3};effectDataSend(n);n={id:id,name:selfPlayer.name,team:selfPlayer.team,x:selfPlayer.x+30,y:selfPlayer.y+70,effected:id,distance:480,type:2,level:.5,time:0,maintime:2e3};effectDataSend(n)}else ActionBarShow("場上沒有任何存活的敵對玩家!")}function building1Down(){musicPlay("building",BuildVolume),animationMainTime=0;var e={name:selfPlayer.name,x:selfPlayer.x+32,y:selfPlayer.y+64,health:20,type:1,team:selfPlayer.team};buildingDataSend(e)}function building2Down(){musicPlay("building",BuildVolume);var e={name:selfPlayer.name,x:selfPlayer.x+32,y:selfPlayer.y+64,health:100,type:2,team:selfPlayer.team};buildingDataSend(e)}function building3Down(){musicPlay("building",BuildVolume);var e={name:selfPlayer.name,x:selfPlayer.x+32,y:selfPlayer.y+64,health:50,type:3,team:selfPlayer.team};buildingDataSend(e)}function building4Down(){musicPlay("building",BuildVolume);var e={name:selfPlayer.name,x:selfPlayer.x+32,y:selfPlayer.y+64,health:20,type:4,team:selfPlayer.team};buildingDataSend(e)}function building5Down(){musicPlay("building",BuildVolume);var e={name:selfPlayer.name,x:selfPlayer.x+32,y:selfPlayer.y+64,health:50,type:5,team:selfPlayer.team};buildingDataSend(e)}function buildingTest(){for(let[e,a]of Object.entries(buildinglist))if(Math.pow(a.x-55-selfPlayer.x,2)+Math.pow(a.y-64-selfPlayer.y,2)<15e3)return!0;return!1}
