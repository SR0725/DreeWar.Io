var canvas,ctx,player,offset,animationTime=0,animationMainTime=0;function gameStart(){for(let[e,l]of Object.entries(playerlist_buffer))if(l.id==id){selfPlayer.health=l.health,selfPlayer.team=l.team,selfPlayer.mp=l.mp,selfPlayer.speed=l.speed;break}playerlist_Now=playerlist,1==selfPlayer.team?(selfPlayer.x=30,selfPlayer.y=760):(selfPlayer.x=3987,selfPlayer.y=760),document.getElementById("chat_box_collapse").className="collapse collapse-horizontal",document.getElementById("talkroomOpen").style.display="block",document.getElementById("MainSence").innerHTML='<canvas id="Game_Bg" width="'+Window_width+'" height="'+Window_height+'" style="cursor: none;"></canvas>',canvas=document.getElementById("Game_Bg"),ctx=canvas.getContext("2d"),obstx.drawImage(obsimg,0,0,4230,1650),gamestat=2,skillCardInit(),setTimeout(function(){gameMouseInput()},500),Update(),draw(),musicPlay("begin",HumanVolume)}function smoothData(e){if(0==e){for(let[e,l]of Object.entries(playerlist))if(l.id!=id&&"tick"!=l.id){playerlist_Now[e].motion_x=(l.x+playerlist_Now[e].motion_x*playerlist_UT-playerlist_Now[e].x)/(ping_player/20),playerlist_Now[e].motion_y=(l.y+playerlist_Now[e].motion_y*playerlist_UT-playerlist_Now[e].y)/(ping_player/20);break}}else if(1==e)for(let[e,l]of Object.entries(skillObjectlist))if("tick"!=l.id){skillObjectlist_Now[e].motion_x=(l.x-skillObjectlist_Now[e].x)/(ping_skill/20),skillObjectlist_Now[e].motion_y=(l.y-skillObjectlist_Now[e].y)/(ping_skill/20);break}}function colliderSenceTest(e,l){return obstx.getImageData(e,l,1,1).data[3]<200?0:obstx.getImageData(e,l,1,1).data[0]>200?0:obstx.getImageData(e,l,1,1).data[2]>200?.4:1}function colliderBoxCircle(e,l,a,i,t,o,s){return Math.pow(e+.5*a-t,2)+Math.pow(l+30+.5*i-o,2)<=Math.pow(s+32,2)}function footStepSound(){animationTime%15==1&&musicPlay("footstep_"+Math.floor(9.999*Math.random()),FootVolume)}function selfPysicalCal(){1==key_s&&0==key_w?(footStepSound(),selfPlayer.motion_y<=selfPlayer.speed&&(selfPlayer.motion_y+=1.6,0==selfPlayer.animation&&(selfPlayer.animation=1))):0==key_s&&1==key_w&&(footStepSound(),-1*selfPlayer.motion_y<=selfPlayer.speed&&(selfPlayer.motion_y-=1.6,0==selfPlayer.animation&&(selfPlayer.animation=1))),1==key_d&&0==key_a?(footStepSound(),selfPlayer.motion_x<=selfPlayer.speed&&(selfPlayer.motion_x+=1.6,selfPlayer.flip=!1,0==selfPlayer.animation&&(selfPlayer.animation=1))):0==key_d&&1==key_a&&(footStepSound(),-1*selfPlayer.motion_x<=selfPlayer.speed&&(selfPlayer.motion_x-=1.6,selfPlayer.flip=!0,0==selfPlayer.animation&&(selfPlayer.animation=1))),0==key_w&&0==key_s&&0==key_a&&0==key_d&&1==selfPlayer.animation&&(selfPlayer.animation=0),2==selfPlayer.animation&&(animationMainTime>6?(selfPlayer.animation=0,animationMainTime=0):animationMainTime++),0==key_w&&0==key_s&&0!=selfPlayer.motion_y&&(selfPlayer.motion_y-=.6*selfPlayer.motion_y,Math.abs(selfPlayer.motion_y)<.1&&(selfPlayer.motion_y=0)),0==key_a&&0==key_d&&0!=selfPlayer.motion_x&&(selfPlayer.motion_x-=.6*selfPlayer.motion_x,Math.abs(selfPlayer.motion_x)<.1&&(selfPlayer.motion_x=0)),0==Tracing?0==colliderSenceTest(selfPlayer.x,selfPlayer.y)?(selfPlayer.x+=selfPlayer.motion_x,selfPlayer.y+=selfPlayer.motion_y):(selfPlayer.x+=selfPlayer.motion_x*colliderSenceTest(selfPlayer.x+selfPlayer.motion_x,selfPlayer.y),selfPlayer.y+=selfPlayer.motion_y*colliderSenceTest(selfPlayer.x,selfPlayer.y+selfPlayer.motion_y)):tracing()}function tracing(){selfPlayer.x+=TracingObmx,selfPlayer.y+=TracingObmy,TracingOs+=1,TracingOs>=40&&(Tracing=!1)}function Update(){try{playerlist_buffer.tick>gametick_player&&(gametick_player=playerlist_buffer.tick,ping_player=Date.now(),ping_player-=ping_old_player,ping_old_player=Date.now(),playerlist_Now=playerlist,playerlist=playerlist_buffer,playerlist_UT=0,smoothData(0)),skillObjectlist_buffer.tick>gametick_skill&&(gametick_skill=skillObjectlist_buffer.tick,ping_skill=Date.now(),ping_skill-=ping_old_skill,ping_old_skill=Date.now(),skillObjectlist_Now=skillObjectlist,skillObjectlist=skillObjectlist_buffer,skillObjectlist_UT=0,smoothData(1))}catch(e){}Window_height!=window.innerHeight&&(canvas.height=window.innerHeight,Window_height=window.innerHeight),Window_width!=window.innerWidth&&(canvas.width=window.innerWidth,Window_width=window.innerWidth),respawnTime<=0?selfPysicalCal():(respawnTime-=1,0==respawnTime&&(1==selfPlayer.team?(selfPlayer.x=30,selfPlayer.y=760):2==selfPlayer.team&&(selfPlayer.x=3987,selfPlayer.y=760)));for(let[e,l]of Object.entries(playerlist_buffer))if(l.id==id){selfPlayer.health=l.health,selfPlayer.team=l.team,selfPlayer.mp=l.mp,selfPlayer.bp=l.bp,selfPlayer.speed=l.speed,selfPlayer.damage=l.damage;break}(animationTime+=1)>300&&(animationTime=0),playerlist_UT+=1,actionBarTime>=0&&(actionBarTime-=1),playerDataSend(),setTimeout("Update()",20)}
