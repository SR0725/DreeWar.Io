var hurtAnimationTime=0;function RayTest(e,t,i,a){for(var l=(i-e)/10,n=(a-t)/10,o=1;o<10;o++)if(obstx.getImageData(e+l*o,t+n*o,1,1).data[0]>200)return!0;return!1}function BuildVisibleTest(e,t,i,a){var l=Math.pow(e-i,2)+Math.pow(t-a,2);return l<36e4?obstx.getImageData(e,t,1,1).data[1]>100?.4:1:l<722500?obstx.getImageData(e,t,1,1).data[1]>100?.1-(l-36e4)/362500<0?0:.1-(l-36e4)/362500:1-(l-36e4)/362500:0}function distanceCount(e,t,i,a){return Math.sqrt(Math.pow(i-e,2)+Math.pow(a-t,2))}function VisibleTest(e,t,i,a){var l=Math.pow(e-i,2)+Math.pow(t-a,2);return l<36e4?RayTest(e,t,i,a)?.3:obstx.getImageData(e,t,1,1).data[1]>100?.4:1:l<722500?RayTest(e,t,i,a)?.3-(l-36e4)/362500<0?0:.3-(l-36e4)/362500:obstx.getImageData(e,t,1,1).data[1]>100?.4-(l-36e4)/362500<0?0:.4-(l-36e4)/362500:1-(l-36e4)/362500:0}function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);var e=document.getElementById("blue_desert");ctx.drawImage(e,0,0,Window_width,Window_height),TerrainDraw(),1==displayWave&&TerrainDecDraw(),buildingDisplay(),playerDisplay(),skillDisplay(),particleDisplay(),UI_bp_mpDisplay(),UI_pingAndFPSDisplay();var t=0;for(let[i,a]of Object.entries(effectlist)){e=document.getElementById("effect"+a.effect);ctx.drawImage(e,Window_width-80,Window_height-80*(t+3),64,64),t++,a.time+=20,a.time>=a.maintime&&delete effectlist[i]}if(hurtAnimationTime>0&&(ctx.fillStyle="rgba(255,30,30,"+(hurtAnimationTime/10*.3).toString()+")",ctx.fillRect(0,0,Window_width,Window_height),hurtAnimationTime-=1),respawnTime>0){var i=respawnTime/500>.5?respawnTime/500:.5;ctx.fillStyle="rgba(0,0,0,"+i.toString()+")",ctx.fillRect(0,0,Window_width,Window_height)}fps_T1=fps_T2,fps_T2=Date.now(),fps_T=fps_T2-fps_T1,actionBarTime>=0&&UI_ActionBarDisplay(),mouseRight&&emotionSelect(),gameDisplay(),newPlayerTipAnimation<19&&newPlayerTip(),tabUse&&tabInfoDisplay(),winAnimation>0&&winAnimationDisplay(),loseAnimation>0&&loseAnimationDisplay(),mouseCircle(),setTimeout("draw()",1e3/FramePerSencond)}function tabInfoDisplay(){try{ctx.fillStyle="rgba(30,30,30,100)",ctx.fillRect(.1*Window_width,.1*Window_height,.8*Window_width,.8*Window_height),ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="21px Verdana";var e=0;for(let[n,o]of Object.entries(playerlist_Now)){var t=.2*Window_width,i=.2*Window_height+32*e,a=o.name+"－擊殺數："+kdalist[n].kill+"－死亡數："+kdalist[n].death+"－輔助數："+kdalist[n].support,l=ctx.measureText(a).width;ctx.fillStyle="rgba(16,16,16,0.4)",ctx.fillRect(t-6,i+16,l+14,30),ctx.fillStyle="rgba(245,245,245,1)",ctx.fillText(a,t+1,i+32),e+=1}}catch(e){}}function winAnimationDisplay(){winAnimation+=1;var e=.5*Window_width-192,t=.2*Window_height;winAnimation<50?(ctx.fillStyle="rgba(0,0,0,"+3.5*winAnimation/255+")",t=.2*Window_height+400-8*winAnimation):(ctx.fillStyle="rgba(0,0,0,0.686)",t=.2*Window_height),ctx.fillRect(0,0,Window_width,Window_height);for(var i=0;i<6;i++){var a=document.getElementById("wood_"+i);ctx.drawImage(a,e+64*i,t,64,64)}}function loseAnimationDisplay(){loseAnimation+=1;var e=.5*Window_width-160,t=.2*Window_height;loseAnimation<50?(ctx.fillStyle="rgba(0,0,0,"+3.5*loseAnimation/255+")",t=.2*Window_height+400-8*loseAnimation):(ctx.fillStyle="rgba(0,0,0,0.686)",t=.2*Window_height),ctx.fillRect(0,0,Window_width,Window_height);for(var i=0;i<5;i++){var a=document.getElementById("metal_"+i);ctx.drawImage(a,e+64*i,t,64,64)}}function emotionSelect(){for(var e=Window_width/2,t=Window_height/2,i=1;i<=7;i++){var a=document.getElementById("emoteUI_"+i);ctx.drawImage(a,e+200*Math.cos(i/7*2*PI),t+200*Math.sin(i/7*2*PI),64,76)}}function gameDisplay(){ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="21px Verdana";var e=.45*Window_width,t=48,i=document.getElementById("box");ctx.drawImage(i,e+32,t,.1*Window_width,5),e=.485*Window_width,t=30,i=document.getElementById("midtree"),ctx.drawImage(i,e+.066*Window_width*(occupyTime+5)/10,t,10,20),e=.45*Window_width,t=10,i=document.getElementById("hudPlayer_blue"),ctx.drawImage(i,e,t,64,64);var a=ctx.measureText(bluescore).width;ctx.fillStyle="rgba(16,16,16,0.4)",ctx.fillRect(e-6-a,t+16,a+14,30),ctx.fillStyle="rgba(245,245,245,1)",ctx.fillText(bluescore,e+1-a,t+32),e=.55*Window_width,t=10,i=document.getElementById("hudPlayer_pink"),ctx.drawImage(i,e,t,64,64),a=ctx.measureText(redscore).width,ctx.fillStyle="rgba(16,16,16,0.4)",ctx.fillRect(e+56,t+16,a+14,30),ctx.fillStyle="rgba(245,245,245,1)",ctx.fillText(redscore,e+63,t+32)}function TerrainDraw(){var e=document.getElementById("scence");ctx.drawImage(e,-1*(selfPlayer.x-Window_width/2)+hurtAnimationTime%5*5,-1*(selfPlayer.y-Window_height/2-75)+hurtAnimationTime%5*5,4230,1650)}function occupyCircleDraw(e,t){-5==occupyTime?(img=document.getElementById("hudPlayer_blue"),ctx.drawImage(img,e-32,t-232,64,64)):5==occupyTime?(img=document.getElementById("hudPlayer_pink"),ctx.drawImage(img,e-32,t-232,64,64)):(occupyTime>0?(ctx.beginPath(),ctx.moveTo(e,t-200),ctx.arc(e,t-200,30,0,2*Math.PI*(occupyTime/5),!1),ctx.closePath(),ctx.fillStyle="rgba(220,130,100,1.0)",ctx.fill()):occupyTime<0&&(ctx.beginPath(),ctx.moveTo(e,t-200),ctx.arc(e,t-200,30,0,-2*Math.PI*(occupyTime/5),!1),ctx.closePath(),ctx.fillStyle="rgba(100,130,220,1.0)",ctx.fill()),img=document.getElementById("hudPlayer_mid"),ctx.drawImage(img,e-32,t-232,64,64))}function foccupyCircleDraw(e,t,i){-3==foccupyTime[i]?(img=document.getElementById("hudPlayer_blue"),ctx.drawImage(img,e-32,t-32,64,64)):3==foccupyTime[i]?(img=document.getElementById("hudPlayer_pink"),ctx.drawImage(img,e-32,t-32,64,64)):(foccupyTime[i]>0?(ctx.beginPath(),ctx.moveTo(e,t),ctx.arc(e,t,30,0,2*Math.PI*(foccupyTime[i]/3),!1),ctx.closePath(),ctx.fillStyle="rgba(220,130,100,1.0)",ctx.fill()):foccupyTime[i]<0&&(ctx.beginPath(),ctx.moveTo(e,t),ctx.arc(e,t,30,0,-2*Math.PI*(foccupyTime[i]/3),!1),ctx.closePath(),ctx.fillStyle="rgba(100,130,220,1.0)",ctx.fill()),img=document.getElementById("hudPlayer_mid"),ctx.drawImage(img,e-32,t-32,64,64))}function buildingDisplay(){for(let[a,l]of Object.entries(buildinglist))if(Math.abs(l.x-selfPlayer.x)<Window_width/2+50&&Math.abs(l.y-selfPlayer.y)<Window_height/2+50){var e,t=l.x-selfPlayer.x+Window_width/2,i=l.y-selfPlayer.y+Window_height/2;switch(1==displayBuildingMist&&(ctx.globalAlpha=BuildVisibleTest(l.x-55,l.y-64,selfPlayer.x,selfPlayer.y)),l.type){case 1:e=1==l.team?document.getElementById("beegen_blue"):document.getElementById("beegen_red"),ctx.drawImage(e,t-55,i-64,111,128),1==displayBuildingHp&&hpBarDisplay(t,i,l.health,20,72,62);break;case 2:e=document.getElementById("wall"),ctx.drawImage(e,t-55,i-64,111,128),1==displayBuildingHp&&hpBarDisplay(t,i,l.health,100,72,62);break;case 3:e=1==l.team?document.getElementById("fort_blue"):document.getElementById("fort_red"),ctx.drawImage(e,t-55,i-64,111,128),1==displayBuildingHp&&hpBarDisplay(t,i,l.health,50,72,62);break;case 4:e=1==l.team?document.getElementById("flowergen_blue"):document.getElementById("flowergen_red"),ctx.drawImage(e,t-64,i-64,128,128),1==displayBuildingHp&&hpBarDisplay(t,i,l.health,20,72,62);break;case 5:e=document.getElementById("hptower"),ctx.drawImage(e,t-55,i-80,111,160),e=document.getElementById("hptower_animation"),ctx.drawImage(e,t-55,i-80-30*Math.sin(animationTime%50/50*Math.PI),111,160),1==displayBuildingHp&&hpBarDisplay(t,i,l.health,50,72,62)}ctx.globalAlpha=1}t=2130-selfPlayer.x+Window_width/2,i=696-selfPlayer.y+Window_height/2;e=document.getElementById("midtree"),ctx.drawImage(e,t-102,i-212,204,414),occupyCircleDraw(t,i);t=1614-selfPlayer.x+Window_width/2,i=361-selfPlayer.y+Window_height/2;e=document.getElementById("frog_t"),ctx.drawImage(e,t-128,i-128,256,256),foccupyCircleDraw(t,i,1);t=1614-selfPlayer.x+Window_width/2,i=1212-selfPlayer.y+Window_height/2;e=document.getElementById("frog_t"),ctx.drawImage(e,t-128,i-128,256,256),foccupyCircleDraw(t,i,2);t=2692-selfPlayer.x+Window_width/2,i=361-selfPlayer.y+Window_height/2;e=document.getElementById("frog"),ctx.drawImage(e,t-128,i-128,256,256),foccupyCircleDraw(t,i,3);t=2692-selfPlayer.x+Window_width/2,i=1212-selfPlayer.y+Window_height/2;e=document.getElementById("frog"),ctx.drawImage(e,t-128,i-128,256,256),foccupyCircleDraw(t,i,4);t=129-selfPlayer.x+Window_width/2,i=1036-selfPlayer.y+Window_height/2;e=document.getElementById("fort_blue"),ctx.drawImage(e,t-55,i-64,111,128);t=129-selfPlayer.x+Window_width/2,i=636-selfPlayer.y+Window_height/2;e=document.getElementById("fort_blue"),ctx.drawImage(e,t-55,i-64,111,128);t=4019-selfPlayer.x+Window_width/2,i=1036-selfPlayer.y+Window_height/2;e=document.getElementById("fort_red"),ctx.drawImage(e,t-55,i-64,111,128);t=4019-selfPlayer.x+Window_width/2,i=636-selfPlayer.y+Window_height/2;e=document.getElementById("fort_red"),ctx.drawImage(e,t-55,i-64,111,128)}function playerEmotion(e,t,i){img=document.getElementById("emote_"+i),ctx.drawImage(img,e+8,t-16,48,57)}function playerDisplay(){for(let[i,a]of Object.entries(playerlist_Now))if(a.id!=id){if(Math.abs(a.x-selfPlayer.x)<Window_width/2+50&&Math.abs(a.y-selfPlayer.y)<Window_height/2+50){var e=a.x+a.motion_x*playerlist_UT-selfPlayer.x+Window_width/2,t=a.y+a.motion_y*playerlist_UT-selfPlayer.y+Window_height/2;ctx.globalAlpha=VisibleTest(a.x,a.y,selfPlayer.x,selfPlayer.y),1==a.flip?ObjectFlipDraw(a,e,t):ObjectDraw(a,e,t),hpBarDisplay(e,t,a.health,100,42,12),mpBarDisplay(e,t,a.mp,10,42,26),nameDisplay(e,t,a.name),ctx.globalAlpha=1;try{emotionList[i].id==a.id&&(playerEmotion(e,t,emotionList[i].type),emotionList[i].time<0?delete emotionList[i]:emotionList[i].time-=1)}catch(e){}}}else if("tick"!=a.id){e=Window_width/2,t=Window_height/2;obstx.getImageData(a.x,a.y,1,1).data[1]>100&&(ctx.globalAlpha=.4),1==selfPlayer.flip?ObjectFlipDraw(selfPlayer,e,t):ObjectDraw(selfPlayer,e,t),hpBarDisplay(e,t,a.health,100,42,12),mpBarDisplay(e,t,a.mp,10,42,26),nameDisplay(e,t,a.name),ctx.globalAlpha=1;try{emotionList[i].id==a.id&&(playerEmotion(e,t,emotionList[i].type),emotionList[i].time<0?delete emotionList[i]:emotionList[i].time-=1)}catch(e){}}}function ObjectDraw(e,t,i){if(1==e.animation)if(animationTime%16<8){if(1==e.team)var a=document.getElementById("alienBlue_walk1");else a=document.getElementById("alienPink_walk1");ctx.drawImage(a,t,i,64,128)}else{if(1==e.team)a=document.getElementById("alienBlue_walk2");else a=document.getElementById("alienPink_walk2");ctx.drawImage(a,t,i,64,128)}else if(2==e.animation){if(1==e.team)a=document.getElementById("alienBlue_duck");else a=document.getElementById("alienPink_duck");ctx.drawImage(a,t,i,64,128)}else{if(1==e.team)a=document.getElementById("alienBlue_front");else a=document.getElementById("alienPink_front");ctx.drawImage(a,t,i,64,128)}}function ObjectFlipDraw(e,t,i){if(ctx.translate(Window_width+70,0),ctx.scale(-1,1),ctx.translate(2*(Window_width/2-t),0),1==e.animation)if(animationTime%16<8){if(1==e.team)var a=document.getElementById("alienBlue_walk1");else a=document.getElementById("alienPink_walk1");ctx.drawImage(a,t,i,64,128)}else{if(1==e.team)a=document.getElementById("alienBlue_walk2");else a=document.getElementById("alienPink_walk2");ctx.drawImage(a,t,i,64,128)}else if(2==e.animation){if(1==e.team)a=document.getElementById("alienBlue_duck");else a=document.getElementById("alienPink_duck");ctx.drawImage(a,t,i,64,128)}else{if(1==e.team)a=document.getElementById("alienBlue_front");else a=document.getElementById("alienPink_front");ctx.drawImage(a,t,i,64,128)}ctx.translate(Window_width+70,0),ctx.scale(-1,1),ctx.translate(2*(Window_width/2-t),0)}function skillDisplay(){for(let[a,l]of Object.entries(skillObjectlist))switch(l.skill){case 0:if(Math.abs(l.x-selfPlayer.x)<Window_width/2+50&&Math.abs(l.y-selfPlayer.y)<Window_height/2+50){var e=l.x+l.motion_x*skillObjectlist_UT-selfPlayer.x+Window_width/2,t=l.y-selfPlayer.y+Window_height/2,i=document.getElementById("fireball");ctx.globalAlpha=VisibleTest(l.x,l.y,selfPlayer.x,selfPlayer.y),ctx.drawImage(i,e-32,t-32,64,64),ctx.globalAlpha=1}break;case 2:switch(l.race){case 1:if(Math.abs(l.x-selfPlayer.x)<Window_width/2+50&&Math.abs(l.y-selfPlayer.y)<Window_height/2+50){e=l.x+l.motion_x*skillObjectlist_UT-selfPlayer.x+Window_width/2,t=l.y-selfPlayer.y+Window_height/2,i=document.getElementById("brickBrown");ctx.globalAlpha=VisibleTest(l.x,l.y,selfPlayer.x,selfPlayer.y),ctx.drawImage(i,e-8,t-8,16,16),ctx.globalAlpha=1}}}}function UI_bp_mpDisplay(){for(var e=Window_width-250,t=Window_height-194,i=(e=Window_width-105,t=Window_height-94,document.getElementById("mp_s")),a=0;a<selfPlayer.mp;a++)ctx.drawImage(i,e+28-115*Math.cos(a/15*PI),t-115*Math.sin(a/15*PI),26,45);e=Window_width-250,t=Window_height-194;i=document.getElementById("Bar");ctx.drawImage(i,e,t,250,194);i=document.getElementById("bp"+selfPlayer.bp);ctx.drawImage(i,e,t,250,194),e=Window_width-143,t=Window_height-121;i=document.getElementById("hp_s");ctx.drawImage(i,0,86,95,selfPlayer.health/100*-86,e,t+(123-selfPlayer.health/100*123),142,selfPlayer.health/100*123)}function UI_pingAndFPSDisplay(){animationTime%50==1&&(ping=Math.floor((ping_skill+ping_player)/2),fps=Math.floor(1e3/fps_T)),ctx.fillStyle="rgba(16,16,16,0.4)",ctx.fillRect(64,4,ctx.measureText("Ping: "+ping+"ms").width+14,24),ctx.fillRect(64,32,ctx.measureText("FPS: "+fps).width+14,24),ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="16px Verdana",ctx.fillStyle="rgba(245,245,245,1)",ctx.fillText("Ping: "+ping+"ms",72,17),ctx.fillText("FPS: "+fps,72,45)}function ActionBarShow(e){actionBarMSG=e,actionBarTime=80}function UI_ActionBarDisplay(){ctx.textAlign="left",ctx.textBaseline="middle",ctx.font="21px Verdana",ctx.fillStyle="rgba(16,16,16,0.4)",ctx.fillRect(.1*Window_width-8,Window_height-266+actionBarTime/80*100,ctx.measureText(actionBarMSG).width+14,30),ctx.fillStyle="rgba(245,245,245,1)",ctx.fillText(actionBarMSG,.1*Window_width,Window_height-250+actionBarTime/80*100)}function particleDisplay(){for(let[d,c]of Object.entries(particlelist)){if(Math.abs(c.x-selfPlayer.x)<Window_width/2+50&&Math.abs(c.y-selfPlayer.y)<Window_height/2+50){ctx.globalAlpha=VisibleTest(c.x,c.y,selfPlayer.x,selfPlayer.y);var e=VisibleTest(c.x,c.y,selfPlayer.x,selfPlayer.y);switch(c.particle){case 0:var t=document.getElementById("s0_icon");ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2,c.y-selfPlayer.y+Window_height/2-64,64,64);break;case 1:t=document.getElementById("explosion_"+Math.floor(c.time/50));ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2-180,c.y-selfPlayer.y+Window_height/2-180,392,392),1==c.time&&(distance=distanceCount(c.x,c.y,selfPlayer.x,selfPlayer.y),distance<800&&musicPlay("boom",BoomVolume*distance/800));break;case 2:var i=document.getElementById("brickBrown"),a=document.getElementById("brickGrey");if(c.time>500){ctx.globalAlpha=1-e*(c.time-500)/500;var l=1}l=Math.pow(c.time/1e3,.333);for(var n=0;n<20;n++){var o=Math.sin(n)*l*80,m=Math.sin(1.4*n)*l*80;n%2==1?ctx.drawImage(i,c.x-selfPlayer.x+Window_width/2+o,c.y-selfPlayer.y+Window_height/2+m,16,16):ctx.drawImage(a,c.x-selfPlayer.x+Window_width/2+o,c.y-selfPlayer.y+Window_height/2+m,16,16)}break;case 3:for(t=document.getElementById("brickBrown"),n=0;n<10;n++)temp_mx=Math.sin(c.x+171.59*n)*c.time*.12+12*Math.random(),temp_my=Math.sin(c.y+171.59*n)*c.time*.12+12*Math.random(),ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2-8+temp_mx,c.y-selfPlayer.y+Window_height/2-8+temp_my,16,16);break;case 4:t=document.getElementById("hudPlayer_blue");if(c.time>500){ctx.globalAlpha=1-e*(c.time-500)/500;l=1}for(l=Math.pow(c.time/500,.5),n=0;n<20;n++){o=Math.sin(n)*l*150,m=Math.sin(1.4*n)*l*150;ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2+o,c.y-selfPlayer.y+Window_height/2+m,16,16)}distanceCount(c.x,c.y,selfPlayer.x,selfPlayer.y)<900&&musicPlay("occupydown",HumanVolume);break;case 5:t=document.getElementById("hudPlayer_pink");if(c.time>500){ctx.globalAlpha=1-e*(c.time-500)/500;l=1}for(l=Math.pow(c.time/500,.5),n=0;n<20;n++){o=Math.sin(n)*l*150,m=Math.sin(1.4*n)*l*150;ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2+o,c.y-selfPlayer.y+Window_height/2+m,16,16)}distanceCount(c.x,c.y,selfPlayer.x,selfPlayer.y)<900&&musicPlay("occupydown",HumanVolume);break;case 11:t=document.getElementById("1_s1_icon");ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2,c.y-selfPlayer.y+Window_height/2-64,64,64);break;case 12:t=document.getElementById("1_s2_icon");ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2,c.y-selfPlayer.y+Window_height/2-64,64,64);break;case 13:t=document.getElementById("1_s3_icon");ctx.drawImage(t,c.x-selfPlayer.x+Window_width/2,c.y-selfPlayer.y+Window_height/2-64,64,64)}ctx.globalAlpha=1}c.time+=20,c.time>=c.maintime&&delete particlelist[d]}}function wavaObjectDraw(e,t,i,a,l,n,o,m){var d=document.getElementById(e);(m+i-8)%2==0?ctx.drawImage(d,130*(t-7)+Window_width/2-selfPlayer.x%130+Math.abs(animationTime-150)/150*100,98*(i-8)+Window_height/2-selfPlayer.y%98+n,a,l):ctx.drawImage(d,65+130*(t-7)+Window_width/2-selfPlayer.x%130+Math.abs(animationTime-150)/150*100,98*(i-8)+Window_height/2-selfPlayer.y%98+n,a,l)}function hpBarDisplay(e,t,i,a,l,n){var o=e,m=t,d=document.getElementById("hp_e");ctx.drawImage(d,o-l,m+n,147,14);d=document.getElementById("hp");ctx.drawImage(d,0,0,i/a*294,56,o-l,m+n,i/a*147,14);d=document.getElementById("hp_s");ctx.drawImage(d,o-l-18,m+n-3,18,16)}function mpBarDisplay(e,t,i,a,l,n){var o=e,m=t,d=document.getElementById("mp_e");ctx.drawImage(d,o-l,m+n,147,14);d=document.getElementById("mp");ctx.drawImage(d,0,0,i/a*294,56,o-l,m+n,i/a*147,14);d=document.getElementById("mp_s");ctx.drawImage(d,o-l-14,m+n,9,15)}function nameDisplay(e,t,i){var a=e-52,l=t;ctx.fillStyle="rgba(16,16,16,0.4)",ctx.fillRect(a+28-ctx.measureText(i).width/2,l-12,ctx.measureText(i).width+8,24),ctx.textAlign="center",ctx.textBaseline="middle",ctx.font="16px Verdana",ctx.fillStyle="rgba(245,245,245,1)",ctx.fillText(i,a+32,l)}function TerrainDecDraw(){for(py=0;py<Math.ceil(Window_width/260)+2;py++)for(px=0;px<Math.ceil(Window_height/196)+2;px++){var e=parseInt(selfPlayer.x/130),t=parseInt(selfPlayer.y/98);e+px-7>=0&&e+px-7<32&&t+py-8>=0&&t+py-8<16&&"tileWater"==Terrain[t+py-8][e+px-7]&&(wavaObjectDraw("waveWater",px,py,33,10,100,e,t),wavaObjectDraw("waveWater",px,py,33,10,160,e,t))}}var animationCircleTime,mouse_x_animation=0,mouse_y_animation=0,mouse_x_motion=0,mouse_y_motion=0,mouse_x_animationlist={},mouse_y_animationlist={};function mouseCircle(){if(mouse_x_motion=mouse_x_animation-mouse_x,mouse_y_motion=mouse_y_animation-mouse_y,mouse_x_animation-=.25*mouse_x_motion,mouse_y_animation-=.25*mouse_y_motion,mouse_x_motion<.001&&(mouse_x_motion=0),mouse_y_motion<.001&&(mouse_y_motion=0),displayMouseCircleWithoutDelay)for(var e=0;e<15;e++)mouse_x_animationlist[e]=mouse_x,mouse_y_animationlist[e]=mouse_y;else{for(e=0;e<15;e++)0!=e&&(mouse_x_animationlist[e]=mouse_x_animationlist[e-1],mouse_y_animationlist[e]=mouse_y_animationlist[e-1]);mouse_x_animationlist[0]=mouse_x_animation,mouse_y_animationlist[0]=mouse_y_animation}animationCircleTime=animationTime%100;var t="rgba(220,230,255,";for(let[e,i]of Object.entries(playerlist_Now))if(i.id!=id&&colliderBoxCircle(i.x+i.motion_x*playerlist_UT-selfPlayer.x+Window_width/2,i.y+i.motion_y*playerlist_UT-selfPlayer.y+Window_height/2,64,128,mouse_x_animation+32,mouse_y_animation+64,24)){t=i.team!=selfPlayer.team?"rgba(250,50,30,":"rgba(50,80,250,";break}if("rgba(220,230,255,"==t)for(let[e,i]of Object.entries(buildinglist))if(colliderBoxCircle(i.x-selfPlayer.x+Window_width/2,i.y-selfPlayer.y+Window_height/2,64,128,mouse_x_animation+64,mouse_y_animation+136,36)){t=i.team!=selfPlayer.team?"rgba(250,50,30,":"rgba(50,80,250,";break}for(e=0;e<15;e++)ctx.beginPath(),ctx.arc(mouse_x_animationlist[e]+15*Math.cos((animationCircleTime-2*e)/100*2*PI)+32,mouse_y_animationlist[e]+15*Math.sin((animationCircleTime-2*e)/100*2*PI)+64,3-.15*e,0,2*Math.PI,!0),ctx.closePath(),ctx.fillStyle=t+1*(1-e/14)+")",ctx.fill();for(e=0;e<15;e++)ctx.beginPath(),ctx.arc(mouse_x_animationlist[e]+15*Math.cos((animationCircleTime+50-2*e)/100*2*PI)+32,mouse_y_animationlist[e]+15*Math.sin((animationCircleTime+50-2*e)/100*2*PI)+64,3-.15*e,0,2*Math.PI,!0),ctx.closePath(),ctx.fillStyle=t+1*(1-e/14)+")",ctx.fill()}function musicPlay(e,t){var i=document.getElementById(e);i.currentTime=0,i.volume=t*MainVolume,i.play()}
